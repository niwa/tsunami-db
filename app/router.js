define(["jquery","underscore","backbone","jquery.deparam","components/app/AppView","components/app/AppModel","ga"],function(e,t,o,n,r,d,i){var u={},a=o.Router.extend({routes:{"(/)":"root","!(/)":"root","!/page(/*path)":"page","!/db(/*path)":"db"},resetApp:function(){this.navigate("",{trigger:!0})},goHome:function(){this.navigate("!/db",{trigger:!0,replace:!0})},goToFragment:function(e){this.navigate(e,{trigger:!0})},queryAllow:function(e){this.queryDelete(t.difference(t.keys(u.model.getQuery()),e),!0,!0)},queryDelete:function(e,o,n){o="undefined"==typeof o||o,n="undefined"!=typeof n&&n;var r=t.clone(u.model.getQuery());"string"==typeof e?delete r[e]:t.each(e,function(e){delete r[e]}),this.update({query:r,trigger:o,replace:n})},queryUpdate:function(e,o,n,r){return o="undefined"==typeof o||o,n="undefined"!=typeof n&&n,r="undefined"==typeof r||r,e=r?t.extend({},u.model.getQuery(),e):e,this.update({query:e,trigger:o,replace:n}),e},queryToggle:function(e,o){o="undefined"==typeof o||o;var n=t.clone(u.model.getQuery());return"object"==typeof e?t.each(e,function(e,o){t.contains(t.keys(n),o)&&n[o]===e?delete n[o]:n[o]=e},this):t.contains(t.keys(n),e)?delete n[e]:n[e]="true",o&&this.update({query:n}),n},update:function(o){var n="undefined"==typeof o.trigger||o.trigger,r="undefined"!=typeof o.replace&&o.replace,d="undefined"!=typeof o.extendQuery&&o.extendQuery,i="undefined"!=typeof o.route?o.route:u.model.getRoute();i=""!==i?"/"+i:"";var a="undefined"!=typeof o.path?o.path:""!==u.model.getPath()?u.model.getPath():"";a=""!==a?"/"+a:"";var l="undefined"!=typeof o.query?d?t.extend({},u.model.getQuery(),o.query):o.query:u.model.getQuery();t.each(t.clone(l),function(e,t){(!e.length||1===e.length&&""===e[0]||"^^^@]"===e)&&delete l[t]}),l=e.param(l),l=""!==l?"?"+l:"",this.navigate("!"+i+a+l,{trigger:n,replace:r})},goBack:function(){window.history.back()}}),l=function(n){u.Router=new a;var l,p,f=n.config_file,y=window.location.pathname,c=y.replace(/\/$/,"").replace(/^\//,"").split("/");l=c[0],p=c.length>1?c[1]:"","undefined"==typeof window.location.origin&&(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),u.model=u.model||new d({views:{},configFile:f,baseurl:window.location.origin+window.location.pathname,router:u.Router,route:{route:"",path:"",query:{}}}),u.Router.on("route:root",function(){this.navigate("!/db",{trigger:!0,replace:!0})}),u.Router.on("route:db",function(o,n){window.__ga__&&i.loaded&&i("send","event","Explore",null!==o&&"undefined"!=typeof o?o:"list",""),o=null!==o&&"undefined"!=typeof o?o:"",n=null!==n&&"undefined"!=typeof n?e.deparam(n):{},"undefined"==typeof n.out||null===n.out||""===n.out||"undefined"==typeof n.map||null===n.map||""===n.map||"undefined"==typeof n.colorby||null===n.colorby||""===n.colorby?("undefined"!=typeof n.out&&null!==n.out&&""!==n.out||t.extend(n,{out:"map"}),"undefined"!=typeof n.map&&null!==n.map&&""!==n.map||t.extend(n,{map:"control"}),"undefined"!=typeof n.colorby&&null!==n.colorby&&""!==n.colorby||t.extend(n,{colorby:"validity"}),this.update({route:"db",path:o,query:n,extendQuery:!1,trigger:!0,replace:!0})):(u.model.setRoute({route:"db",path:o,query:n}),"undefined"==typeof u.view&&(u.view=new r({model:u.model})))}),u.Router.on("route:page",function(t,o){window.__ga__&&i.loaded&&i("send","event","Page",t,""),t=null!==t&&"undefined"!=typeof t?t:"",o=null!==o&&"undefined"!=typeof o?e.deparam(o):{},""===t?this.update({route:"db",path:"",query:o,extendQuery:!0,trigger:!0,replace:!0}):(u.model.setRoute({route:"page",path:t,query:o}),"undefined"==typeof u.view&&(u.view=new r({model:u.model})))}),o.history.start()};return{initialize:l}});