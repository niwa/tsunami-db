define(["jquery","underscore","backbone","jquery.deparam","components/app/AppView","components/app/AppModel","ga"],function(e,o,t,r,n,i,a){var d={},u=t.Router.extend({routes:{"(/)":"root","!(/)":"root","!/page(/*path)":"page","!/db(/*path)":"db"},resetApp:function(){this.navigate("",{trigger:!0})},goHome:function(){this.navigate("!/db",{trigger:!0,replace:!0})},goToFragment:function(e){this.navigate(e,{trigger:!0})},queryAllow:function(e){this.queryDelete(o.difference(o.keys(d.model.getQuery()),e),!0,!0)},queryDelete:function(e,t,r){t=void 0===t||t,r=void 0!==r&&r;var n=o.clone(d.model.getQuery());"string"==typeof e?delete n[e]:o.each(e,function(e){delete n[e]}),this.update({query:n,trigger:t,replace:r})},queryUpdate:function(e,t,r,n){return t=void 0===t||t,r=void 0!==r&&r,n=void 0===n||n,e=n?o.extend({},d.model.getQuery(),e):e,this.update({query:e,trigger:t,replace:r}),e},queryToggle:function(e,t){t=void 0===t||t;var r=o.clone(d.model.getQuery());return"object"==typeof e?o.each(e,function(e,t){o.contains(o.keys(r),t)&&r[t]===e?delete r[t]:r[t]=e},this):o.contains(o.keys(r),e)?delete r[e]:r[e]="true",t&&this.update({query:r}),r},update:function(t){var r=void 0===t.trigger||t.trigger,n=void 0!==t.replace&&t.replace,i=void 0!==t.extendQuery&&t.extendQuery,a=void 0!==t.route?t.route:d.model.getRoute();a=""!==a?"/"+a:"";var u=void 0!==t.path?t.path:""!==d.model.getPath()?d.model.getPath():"";u=""!==u?"/"+u:"";var l=void 0!==t.query?i?o.extend({},d.model.getQuery(),t.query):t.query:d.model.getQuery();o.each(o.clone(l),function(e,o){(!e.length||1===e.length&&""===e[0]||"^^^@]"===e)&&delete l[o]}),l=e.param(l),l=""!==l?"?"+l:"",this.navigate("!"+a+u+l,{trigger:r,replace:n})},goBack:function(){window.history.back()}});return{initialize:function(r){d.Router=new u;var l=r.config_file,c=window.location.pathname,p=c.replace(/\/$/,"").replace(/^\//,"").split("/");p[0],p.length>1&&p[1],void 0===window.location.origin&&(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),d.model=d.model||new i({views:{},configFile:l,baseurl:window.location.origin+window.location.pathname,router:d.Router,route:{route:"",path:"",query:{}}}),d.Router.on("route:root",function(){this.navigate("!/db",{trigger:!0,replace:!0})}),d.Router.on("route:db",function(t,r){window.__ga__&&a.loaded&&a("send","event","Explore",null!==t&&void 0!==t?t:"list",""),t=null!==t&&void 0!==t?t:"",r=null!==r&&void 0!==r?e.deparam(r):{},void 0===r.out||null===r.out||""===r.out||void 0===r.map||null===r.map||""===r.map||void 0===r.colorby||null===r.colorby||""===r.colorby?(void 0!==r.out&&null!==r.out&&""!==r.out||o.extend(r,{out:"map"}),void 0!==r.map&&null!==r.map&&""!==r.map||o.extend(r,{map:"control"}),void 0!==r.colorby&&null!==r.colorby&&""!==r.colorby||o.extend(r,{colorby:"validity"}),this.update({route:"db",path:t,query:r,extendQuery:!1,trigger:!0,replace:!0})):(d.model.setRoute({route:"db",path:t,query:r}),void 0===d.view&&(d.view=new n({model:d.model})))}),d.Router.on("route:page",function(o,t){window.__ga__&&a.loaded&&a("send","event","Page",o,""),o=null!==o&&void 0!==o?o:"",t=null!==t&&void 0!==t?e.deparam(t):{},""===o?this.update({route:"db",path:"",query:t,extendQuery:!0,trigger:!0,replace:!0}):(d.model.setRoute({route:"page",path:o,query:t}),void 0===d.view&&(d.view=new n({model:d.model})))}),t.history.start()}}});