define(["jquery","underscore","backbone","bootstrap","jquery.select2/select2","text!./mapControl.html","text!./mapControlColorSelect.html","text!./mapControlColorKey.html"],function(t,e,o,l,i,n,r,a){return o.View.extend({events:{"change #select-color-attribute":"colorColumnChanged","click .nav-link":"handleNavLink"},initialize:function(){this.handleActive(),this.render(),this.listenTo(this.model,"change:active",this.handleActive),this.listenTo(this.model,"change:outColorColumn",this.updateOutColorColumn),t(window).on("resize",e.debounce(e.bind(this.resize,this),100))},resize:function(){this.update()},render:function(){return this.$el.html(e.template(n)({t:this.model.getLabels()})),this},initTooltips:function(){this.$('[data-toggle="tooltip"]').tooltip()},update:function(){var t=this.model.getOutColorColumn();this.$("#color-attribute-selector").html(e.template(r)({options:e.sortBy(e.map(this.model.get("columnCollection").byAttribute("colorable").byAttribute("multiples",0).models,function(e){return{value:e.id,label:e.get("title"),selected:e.get("column")===t.get("column")}},this),function(t){return t.label})})),this.$("#select-color-attribute").select2({theme:"mapcontrol",minimumResultsForSearch:1/0});var o=this.model.getOutColorColumn().getValues();this.$("#color-attribute-key").html(e.template(a)({t:this.model.getLabels(),title:t.get("title"),tooltip:t.get("description"),tooltip_more:t.hasMoreDescription(),id:t.id,values:e.map(o.values,function(t,e){var l="undefined"!=typeof o.colors?o.colors[e].colorToRgb():[0,0,0];return{label:"undefined"!=typeof o.labels?o.labels[e]:t,color:"undefined"!=typeof o.colors?o.colors[e]:"",fillColor:"rgba("+l[0]+","+l[1]+","+l[2]+",0.4)"}})})),this.initTooltips()},updateOutColorColumn:function(){this.update()},colorColumnChanged:function(e){e.preventDefault(),this.$el.trigger("colorColumnChanged",{column:t(e.target).val()})},handleActive:function(){this.model.isActive()?this.$el.show():this.$el.hide()},handleNavLink:function(e){e.preventDefault(),e.stopPropagation(),this.$el.trigger("navLink",{id:t(e.currentTarget).attr("data-id"),anchor:t(e.currentTarget).attr("data-page-anchor"),route:"page",type:"page"})}})});