define(["jquery","underscore","backbone","text!./page.html","text!./pageContent.html","text!templates/loading.html"],function(e,t,a,i,n,l){var h=a.View.extend({events:{"click .close-page":"closePage","click a":"pageLink"},initialize:function(){this.render(),this.listenTo(this.model,"change:active",this.handleActive),this.listenTo(this.model,"change:pageId",this.handlePageChange),this.listenTo(this.model,"change:anchor",this.handlePageAnchorChange)},render:function(){return this.model.hasActivePage()&&this.loadPage(),this},loadPage:function(){var e=this.model.getActivePage();if("undefined"!=typeof e){if(this.$el.html(t.template(i)({t:this.model.getLabels(),classes:e.getClass()})),this.$(".page-outer").html(t.template(l)({t:this.model.getLabels()})),this.model.hasActivePage()){var a=this;e.getContent(function(e){a.$(".page-outer").html(t.template(n)({t:a.model.getLabels()})),a.$(".page-outer").removeClass("loading"),a.$(".placeholder-content").html(e),""===a.model.getPageAnchor()&&a.$el.scrollTop(0)})}}else this.$el.html("")},handlePageChange:function(){this.render()},handleActive:function(){this.model.isActive()?this.$el.show():this.$el.hide()},pageLink:function(t){"undefined"!=typeof e(t.target).attr("href")&&e(t.target).attr("href").startsWith("#")&&(t.preventDefault(),this.$el.trigger("navLink",{route:"page",id:this.model.get("pageId"),anchor:e(t.target).attr("href").substring(1)}))},closePage:function(e){e.preventDefault(),this.$el.trigger("pageClose")},handlePageAnchorChange:function(){var e=this.model.getPageAnchor();if(this.model.hasActivePage()&&""!==e){var t=this,a=this.model.getActivePage();waitFor(function(){return a.isContentReady()},function(){var a=t.$("#"+e);a.length>0&&t.$el.scrollTop(t.$el.scrollTop()+a.parent().offset().top-t.$el.offset().top-20)})}}});return h});