define(["jquery","underscore","backbone"],function(t,e,i){return i.Model.extend({initialize:function(t){this.options=t||{},void 0!==this.attributes.featureAttributeMap&&this.mapAttributes(this.attributes.featureAttributeMap),this.set("formatted",{}),this.set("selected",!1),this.set("highlight",!1)},mapAttributes:function(t){e.each(t,function(t,e){this.set(e,null!==this.attributes[t]?this.attributes[t]:"")},this)},setLayer:function(t){this.set("layer",t)},getLayer:function(){return this.attributes.layer},setActive:function(t){t=void 0===t||t,this.set("active",t),this.getLayer()&&this.getLayer().setActive(t)},isSelected:function(){return this.attributes.selected},setSelected:function(t,e){t=void 0===t||t,e=void 0!==e?e:t,this.set("selected",t),this.set("anySelected",e),this.getLayer()&&(this.getLayer().setSelected(t,e),t&&(this.bringToFront(),this.panToViewIfNeeded()))},isHighlight:function(){return this.attributes.highlight},setHighlight:function(t){t=void 0===t||t,this.set("highlight",t),this.getLayer()&&(this.getLayer().setMouseOver(t),t&&this.getLayer().bringToFront())},setColor:function(t){this.set("columnColor",t),this.getLayer()&&this.getLayer().setColor(t)},getColor:function(){return this.attributes.columnColor},isActive:function(){return this.attributes.active},panToViewIfNeeded:function(){this.getLayer()&&this.getLayer().panToViewIfNeeded()},bringToFront:function(){this.getLayer()&&this.getLayer().bringToFront()},centerMap:function(){this.getLayer()&&this.getLayer().centerMap()},getColumnValue:function(t,e){return e=void 0!==e&&e,e?(void 0===this.attributes.formatted[t]&&(this.attributes.formatted[t]=this.formatColumn(t)),this.attributes.formatted[t]):this.attributes[t]},getReferences:function(){return null===this.attributes.references?[]:e.map(this.attributes.references.split(","),function(t){return this.collection.options.references.get(t)},this)},getProxies:function(){return null===this.attributes.proxies?[]:e.map(this.attributes.proxies.split(","),function(t){return this.collection.options.proxies.get(t)},this)},formatColumn:function(t){if(null===this.attributes[t]||""===this.attributes[t])return"&mdash;";var i=this.collection.options.columns.findWhere({column:t});switch(i.get("type")){case"index":if("references"===i.id)return null===this.attributes[t]?"":e.map(this.attributes[t].split(","),function(t){var e=this.collection.options.references.get(t);return void 0!==e?e.getTitle():""},this).join(", ");if("proxies"===i.id)return null===this.attributes[t]?"":this.attributes[t].split(",").join(", ");break;case"categorical":return null===this.attributes[t]?"":e.map(this.attributes[t].split(","),function(t){return t.trim()}).join(", ");case"quantitative":return Math.round(100*this.attributes[t])/100;case"spatial":return Math.round(1e3*this.attributes[t])/1e3;case"date":return this.attributes[t]>0?this.attributes[t]+" AD":this.attributes[t]<0?-1*parseInt(this.attributes[t])+" BC":this.attributes[t];default:return this.attributes[t]}},pass:function(t){for(var i=this.collection.options.columns,s=!0,r=e.keys(t),n=0;n<r.length&&s;){var a=r[n];if("s"===a){s=!1;var u=i.byAttribute("searchable").models,o=t.s.toString(),h="";e.each(o.split(" "),function(t){h+="(?=.*\\b"+t+")"});for(var l=new RegExp(h,"i"),c=0;c<u.length&&!s;){var g=u[c].get("queryColumn"),f=this.get(g);null!==f&&""!==f&&("id"===g?s=f.toString()===o:o.length>3&&(f=f.toString().replace(/[āĀ]/,"a").replace(/[ēĒ]/,"e").replace(/[īĪ]/,"i").replace(/[ōŌ]/,"o").replace(/[ūŪ]/,"u"),s=l.test(f))),c++}}else{var p=i.byQueryColumn(a);if(void 0!==p){var g=p.get("queryColumn"),b=t[a];if(a===p.getQueryColumnByType("min"))if("longitude"===g)if(null===this.get(g))s=!1;else{var f=this.get(g)<0?this.get(g)+360:this.get(g),b=parseFloat(b)<0?parseFloat(b)+360:parseFloat(b);f<b&&(s=!1)}else(null===this.get(g)||this.get(g)<parseFloat(b))&&(s=!1);else if(a===p.getQueryColumnByType("max"))if("longitude"===g)if(null===this.get(g))s=!1;else{var f=this.get(g)<0?this.get(g)+360:this.get(g),b=parseFloat(b)<0?parseFloat(b)+360:parseFloat(b);f>b&&(s=!1)}else(null===this.get(g)||this.get(g)>parseFloat(b))&&(s=!1);else if(isNumber(b))null!==this.get(g)&&this.get(g)===parseFloat(b)||(s=!1);else{var d;d=null===this.get(g)||""===this.get(g)?["null"]:isNumber(this.get(g))?[this.get(g)]:e.map(this.get(g).split(","),function(t){return t.trim()});var y="string"==typeof b?[b]:b;0===e.intersection(y,d).length&&(s=!1)}}}n++}return s},passXY:function(t,e){return!(!this.attributes.active||!this.getLayer())&&this.getLayer().includesXY(t,e)}})});