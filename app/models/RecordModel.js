define(["jquery","underscore","backbone"],function(t,e,i){var s=i.Model.extend({initialize:function(t){this.options=t||{},"undefined"!=typeof this.attributes.featureAttributeMap&&this.mapAttributes(this.attributes.featureAttributeMap),this.set("formatted",{}),this.set("selected",!1),this.set("highlight",!1)},mapAttributes:function(t){e.each(t,function(t,e){this.set(e,null!==this.attributes[t]?this.attributes[t]:"")},this)},setLayer:function(t){this.set("layer",t)},getLayer:function(){return this.attributes.layer},setActive:function(t){t="undefined"==typeof t||t,this.set("active",t),this.getLayer()&&this.getLayer().setActive(t)},isSelected:function(){return this.attributes.selected},setSelected:function(t,e){t="undefined"==typeof t||t,e="undefined"!=typeof e?e:t,this.set("selected",t),this.set("anySelected",e),this.getLayer()&&(this.getLayer().setSelected(t,e),t&&(this.bringToFront(),this.panToViewIfNeeded()))},isHighlight:function(){return this.attributes.highlight},setHighlight:function(t){t="undefined"==typeof t||t,this.set("highlight",t),this.getLayer()&&(this.getLayer().setMouseOver(t),t&&this.getLayer().bringToFront())},setColor:function(t){this.set("columnColor",t),this.getLayer()&&this.getLayer().setColor(t)},getColor:function(){return this.attributes.columnColor},isActive:function(){return this.attributes.active},panToViewIfNeeded:function(){this.getLayer()&&this.getLayer().panToViewIfNeeded()},bringToFront:function(){this.getLayer()&&this.getLayer().bringToFront()},centerMap:function(){this.getLayer()&&this.getLayer().centerMap()},getColumnValue:function(t,e){return e="undefined"!=typeof e&&e,e?("undefined"==typeof this.attributes.formatted[t]&&(this.attributes.formatted[t]=this.formatColumn(t)),this.attributes.formatted[t]):this.attributes[t]},getReferences:function(){return null===this.attributes.references?[]:e.map(this.attributes.references.split(","),function(t){return this.collection.options.references.get(t)},this)},getProxies:function(){return null===this.attributes.proxies?[]:e.map(this.attributes.proxies.split(","),function(t){return this.collection.options.proxies.get(t)},this)},formatColumn:function(t){if(null===this.attributes[t]||""===this.attributes[t])return"&mdash;";var i=this.collection.options.columns.findWhere({column:t});switch(i.get("type")){case"index":if("references"===i.id)return null===this.attributes[t]?"":e.map(this.attributes[t].split(","),function(t){var e=this.collection.options.references.get(t);return"undefined"!=typeof e?e.getTitle():""},this).join(", ");if("proxies"===i.id)return null===this.attributes[t]?"":this.attributes[t].split(",").join(", ");break;case"categorical":return null===this.attributes[t]?"":e.map(this.attributes[t].split(","),function(t){return t.trim()}).join(", ");case"quantitative":return Math.round(100*this.attributes[t])/100;case"spatial":return Math.round(1e3*this.attributes[t])/1e3;case"date":return this.attributes[t]>0?this.attributes[t]+" AD":this.attributes[t]<0?-1*parseInt(this.attributes[t])+" BC":this.attributes[t];default:return this.attributes[t]}},pass:function(t){for(var i=this.collection.options.columns,s=!0,r=e.keys(t),n=0;n<r.length&&s;){var u=r[n];if("s"===u){s=!1;var a=i.byAttribute("searchable").models,o=t.s.toString(),h="";e.each(o.split(" "),function(t){h+="(?=.*\\b"+t+")"});for(var l=new RegExp(h,"i"),c=0;c<a.length&&!s;){var f=a[c].get("queryColumn"),g=this.get(f);null!==g&&""!==g&&("id"===f?s=g.toString()===o:o.length>3&&(g=g.toString().replace(/[āĀ]/,"a").replace(/[ēĒ]/,"e").replace(/[īĪ]/,"i").replace(/[ōŌ]/,"o").replace(/[ūŪ]/,"u"),s=l.test(g))),c++}}else{var p=i.byQueryColumn(u);if("undefined"!=typeof p){var f=p.get("queryColumn"),d=t[u];if(u===p.getQueryColumnByType("min"))if("longitude"===f)if(null===this.get(f))s=!1;else{var g=this.get(f)<0?this.get(f)+360:this.get(f),d=parseFloat(d)<0?parseFloat(d)+360:parseFloat(d);g<d&&(s=!1)}else(null===this.get(f)||this.get(f)<parseFloat(d))&&(s=!1);else if(u===p.getQueryColumnByType("max"))if("longitude"===f)if(null===this.get(f))s=!1;else{var g=this.get(f)<0?this.get(f)+360:this.get(f),d=parseFloat(d)<0?parseFloat(d)+360:parseFloat(d);g>d&&(s=!1)}else(null===this.get(f)||this.get(f)>parseFloat(d))&&(s=!1);else if(isNumber(d))null!==this.get(f)&&this.get(f)===parseFloat(d)||(s=!1);else{var b;b=null===this.get(f)||""===this.get(f)?["null"]:isNumber(this.get(f))?[this.get(f)]:e.map(this.get(f).split(","),function(t){return t.trim()});var y="string"==typeof d?[d]:d;0===e.intersection(y,b).length&&(s=!1)}}}n++}return s},passXY:function(t,e){return!(!this.attributes.active||!this.getLayer())&&this.getLayer().includesXY(t,e)}});return s});