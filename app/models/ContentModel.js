define(["jquery","underscore","backbone","jquery.xml2json","showdown"],function(t,n,e,o,i){return e.Model.extend({initialize:function(t){this.options=t||{},this.isContentLoading=!1,this.isContentLoaded=!1},loadContent:function(n,e){if(this.getUrl()){var o=this;t.support.cors=!0,t.ajax({crossDomain:!0,dataType:this.getFormat(),url:this.getUrl(),success:function(e){switch(o.getFormat()){case"xml":var e=t.xml2json(e);void 0!==e["#document"]&&(e=""!==e["#document"].result.nodes?e["#document"].result.nodes.item.body.und.item.safe_value:"<p>ERROR LOADING RESOURCE: requested resource does not exist</p>"),n(e);break;default:n(e)}},error:function(){console.log("error loading content")}})}else if(void 0!==this.attributes.content)switch(this.getFormat()){case"markdown":var s=new i.Converter({ghCodeBlocks:!1,openLinksInNewWindow:!0});n(s.makeHtml(this.attributes.content));break;default:n(this.attributes.content)}},getFormat:function(){return"html"},isContentReady:function(){return!this.isContentLoading&&this.isContentLoaded},getUrl:function(){if(void 0!==this.attributes.url)return this.attributes.url},getContent:function(t){if(this.isContentLoaded&&void 0!==this.attributes.content&&""!==this.attributes.content[0].innerHTML)t(this.attributes.content);else{var n=this;this.isContentLoading?waitFor(function(){return n.isContentLoaded},function(){t(n.attributes.content,n)}):(this.isContentLoading=!0,this.loadContent(function(e){n.set("content",e),n.isContentLoading=!1,n.isContentLoaded=!0,t(n.attributes.content)}))}}})});