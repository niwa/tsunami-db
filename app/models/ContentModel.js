define(["jquery","underscore","backbone","jquery.xml2json","showdown"],function(t,e,n,o,i){var s=n.Model.extend({initialize:function(t){this.options=t||{},this.isContentLoading=!1,this.isContentLoaded=!1},loadContent:function(e,n){if(this.getUrl()){var o=this;t.support.cors=!0,t.ajax({crossDomain:!0,dataType:this.getFormat(),url:this.getUrl(),success:function(n){switch(o.getFormat()){case"xml":var n=t.xml2json(n);"undefined"!=typeof n["#document"]&&(n=""!==n["#document"].result.nodes?n["#document"].result.nodes.item.body.und.item.safe_value:"<p>ERROR LOADING RESOURCE: requested resource does not exist</p>"),e(n);break;default:e(n)}},error:function(){console.log("error loading content")}})}else if("undefined"!=typeof this.attributes.content)switch(this.getFormat()){case"markdown":var s=new i.Converter({ghCodeBlocks:!1,openLinksInNewWindow:!0});e(s.makeHtml(this.attributes.content));break;default:e(this.attributes.content)}},getFormat:function(){return"html"},isContentReady:function(){return!this.isContentLoading&&this.isContentLoaded},getUrl:function(){if("undefined"!=typeof this.attributes.url)return this.attributes.url},getContent:function(t){if(this.isContentLoaded&&"undefined"!=typeof this.attributes.content&&""!==this.attributes.content[0].innerHTML)t(this.attributes.content);else{var e=this;this.isContentLoading?waitFor(function(){return e.isContentLoaded},function(){t(e.attributes.content,e)}):(this.isContentLoading=!0,this.loadContent(function(n){e.set("content",n),e.isContentLoading=!1,e.isContentLoaded=!0,t(e.attributes.content)}))}}});return s});